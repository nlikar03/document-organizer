{"version":3,"file":"static/js/816.7d2b9a2b.chunk.js","mappings":"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","sources":["clientDownloads.js"],"sourcesContent":["import JSZip from 'jszip';\r\nimport { PDFDocument, rgb } from 'pdf-lib';\r\nimport * as XLSX from 'xlsx';\r\nimport { getFileFromIndexedDB } from './indexedDBHelper';\r\n\r\nexport const addWatermarkToPDF = async (pdfBytes, watermarkText) => {\r\n  try {\r\n    const pdfDoc = await PDFDocument.load(pdfBytes);\r\n    const pages = pdfDoc.getPages();\r\n    const firstPage = pages[0];\r\n    const { width, height } = firstPage.getSize();\r\n    \r\n    firstPage.drawText(watermarkText, {\r\n      x: width - 200,\r\n      y: height - 30,\r\n      size: 20,\r\n      color: rgb(1, 0, 0),\r\n    });\r\n    \r\n    return await pdfDoc.save();\r\n  } catch (error) {\r\n    console.error('Watermark error:', error);\r\n    return pdfBytes;\r\n  }\r\n};\r\n\r\nexport const downloadZipClientSide = async (finalResults, folders) => {\r\n  const zip = new JSZip();\r\n  \r\n  // Create folder structure\r\n  const folderPaths = {};\r\n  for (const folder of folders) {\r\n    const parts = [];\r\n    const ids = folder.id.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const fid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === fid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    const path = parts.join('/');\r\n    folderPaths[folder.id] = path;\r\n    zip.folder(path);\r\n  }\r\n  \r\n  // Add files\r\n  for (const result of finalResults) {\r\n    const file = await getFileFromIndexedDB(result.fileName);\r\n    if (!file) continue;\r\n    \r\n    let fileBytes = await file.arrayBuffer();\r\n    \r\n    // Add watermark to PDFs\r\n    if (file.name.toLowerCase().endsWith('.pdf')) {\r\n      fileBytes = await addWatermarkToPDF(fileBytes, result.docCode);\r\n    }\r\n    \r\n    const base = file.name.substring(0, file.name.lastIndexOf('.'));\r\n    const ext = file.name.substring(file.name.lastIndexOf('.'));\r\n    const newName = `${String(result.fileNumber).padStart(3, '0')}_${base}${ext}`;\r\n    const path = `${folderPaths[result.suggestedFolder.id]}/${newName}`;\r\n    \r\n    zip.file(path, fileBytes);\r\n  }\r\n  \r\n  const blob = await zip.generateAsync({ type: 'blob' });\r\n  const url = window.URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = 'DZO_Dokumenti.zip';\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  window.URL.revokeObjectURL(url);\r\n  document.body.removeChild(a);\r\n};\r\n\r\nexport const downloadExcelClientSide = async (finalResults, folders) => {\r\n  \r\n  const buildFolderPath = (folderId) => {\r\n    const parts = [];\r\n    const ids = folderId.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const pid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === pid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    return parts.join(' / ');\r\n  };\r\n  \r\n  const sorted = [...finalResults].sort((a, b) => \r\n    a.suggestedFolder.id.localeCompare(b.suggestedFolder.id)\r\n  );\r\n  \r\n  const data = [\r\n    ['Zap. št.', 'Ime dokazila oz. na kaj se dokazilo nanaša', 'Izdajatelj', 'Št. dokazila', 'Datum', 'Kategorija', 'Koda dokumenta']\r\n  ];\r\n  \r\n  for (const res of sorted) {\r\n    data.push([\r\n      res.fileNumber,\r\n      res.documentTitle || '',\r\n      res.issuer || '',\r\n      res.documentNumber || '',\r\n      res.date || '',\r\n      buildFolderPath(res.suggestedFolder.id),\r\n      res.docCode\r\n    ]);\r\n  }\r\n  \r\n  const ws = XLSX.utils.aoa_to_sheet(data);\r\n  const wb = XLSX.utils.book_new();\r\n  XLSX.utils.book_append_sheet(wb, ws, 'Seznam Dokumentov');\r\n  XLSX.writeFile(wb, 'DZO_Dokumenti_Seznam.xlsx');\r\n};"],"names":["addWatermarkToPDF","async","pdfBytes","watermarkText","pdfDoc","PDFDocument","load","firstPage","getPages","width","height","getSize","drawText","x","y","size","color","rgb","save","error","console","downloadZipClientSide","finalResults","folders","zip","JSZip","folderPaths","folder","parts","ids","id","split","i","length","fid","slice","join","f","find","push","name","path","result","file","getFileFromIndexedDB","fileName","fileBytes","arrayBuffer","toLowerCase","endsWith","docCode","base","substring","lastIndexOf","ext","newName","concat","String","fileNumber","padStart","suggestedFolder","blob","generateAsync","type","url","window","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","revokeObjectURL","removeChild","downloadExcelClientSide","buildFolderPath","folderId","pid","sorted","sort","b","localeCompare","data","res","documentTitle","issuer","documentNumber","date","ws","XLSX","aoa_to_sheet","wb","book_new","book_append_sheet"],"ignoreList":[],"sourceRoot":""}