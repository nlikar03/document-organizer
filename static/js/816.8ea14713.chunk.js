"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[816],{816:(e,t,o)=>{o.d(t,{downloadExcelClientSide:()=>h,downloadZipClientSide:()=>f});var n=o(555),a=o(159),r=o.n(a),c=o(105),s=o(238),i=o(611);const l=async(e,t)=>{try{const o=await c.PDFDocument.load(e),n=o.getPages();if(0===n.length)return e;const a=n[0],{width:r,height:s}=a.getSize(),i=a.getRotation().angle%360,l=await o.embedFont(c.StandardFonts.HelveticaBold),d=20,f=30,h=l.widthOfTextAtSize(t,d),p=d;let u,m;switch(i){case 90:u=f+p,m=s-f-h;break;case 180:u=f+h,m=f;break;case 270:u=r-f-p,m=f+h;break;default:u=r-h-f,m=s-f-p}return a.drawText(t,{x:u,y:m,size:d,font:l,color:(0,c.rgb)(1,0,0),rotate:(0,c.degrees)(i)}),await o.save()}catch(o){return console.error("Watermark error:",o),e}},d=e=>{var t,o;return null!==(t=null===(o=e.suggestedFolder)||void 0===o?void 0:o.id)&&void 0!==t?t:e.folderId},f=async(e,t)=>{const o=new(r()),n={};for(const r of t){const e=[],a=r.id.split(".");for(let o=0;o<a.length;o++){const n=a.slice(0,o+1).join("."),r=t.find(e=>e.id===n);r&&e.push(r.name)}const c=e.join("/");n[r.id]=c,o.folder(c)}for(const r of e){const e=await(0,i.getFileFromIndexedDB)(r.fileName);if(!e)continue;let t=await e.arrayBuffer();e.name.toLowerCase().endsWith(".pdf")&&(t=await l(t,r.docCode));const a=e.name.substring(0,e.name.lastIndexOf(".")),c=e.name.substring(e.name.lastIndexOf(".")),s="".concat(String(r.fileNumber).padStart(3,"0"),"_").concat(a).concat(c),f=d(r),h=n[f];if(!h){console.warn('No folder path found for folderId "'.concat(f,'" on file "').concat(r.fileName,'" \u2014 skipping.'));continue}const p="".concat(h,"/").concat(s);o.file(p,t)}const a=await o.generateAsync({type:"blob"}),c=window.URL.createObjectURL(a),s=document.createElement("a");s.href=c,s.download="DZO_Dokumenti.zip",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(c),document.body.removeChild(s)},h=async(e,t)=>{const o=[...e].sort((e,t)=>d(e).localeCompare(d(t))),a={};o.forEach(e=>{const o=(e=>{const o=[],n=e.split(".");for(let a=0;a<n.length;a++){const e=n.slice(0,a+1).join("."),r=t.find(t=>t.id===e);r&&o.push(r.name)}return o})(d(e)),r=o[0]||"Neznano";a[r]||(a[r]=[]),a[r].push((0,n.A)((0,n.A)({},e),{},{__pathArr:o}))});const r=[],c=[];let i=0;Object.keys(a).sort().forEach(e=>{const t=i;r.push([e,"","","","",""]),c.push({row:t,type:"section"}),i++;const o=i;r.push(["zap. \u0161t.","ime dokazila oz. na kaj se dokazilo nana\u0161a","Originalna datoteka","Izdajatelj","\u0161t. dokazila","datum"]),c.push({row:o,type:"header"}),i++;let n=1;a[e].forEach(e=>{r.push([n++,e.documentTitle||"",e.originalFileName||e.fileName||"",e.issuer||"",e.documentNumber||"",e.date||""]),i++}),r.push(["","","","","",""]),i++});const l=s.Wp.aoa_to_sheet(r);c.forEach(e=>{const t=s.Wp.encode_cell({r:e.row,c:0});if("section"===e.type&&(l[t].s={font:{bold:!0,sz:11},alignment:{horizontal:"left",vertical:"center"}}),"description"===e.type&&(l[t].s={font:{italic:!0,sz:9},alignment:{horizontal:"left",vertical:"center",wrapText:!0}}),"header"===e.type)for(let o=0;o<6;o++){const t=s.Wp.encode_cell({r:e.row,c:o});l[t]&&(l[t].s={font:{bold:!0,sz:10},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}}}})}}),r.forEach((e,t)=>{if(!c.some(e=>e.row===t))for(let o=0;o<6;o++){const e=s.Wp.encode_cell({r:t,c:o});l[e]&&(l[e].s={border:{left:{style:"dotted",color:{rgb:"CCCCCC"}},right:{style:"dotted",color:{rgb:"CCCCCC"}},bottom:{style:"dotted",color:{rgb:"CCCCCC"}}}})}}),l["!cols"]=[{wch:8},{wch:45},{wch:35},{wch:30},{wch:20},{wch:12},{wch:5}],l["!merges"]||(l["!merges"]=[]),c.forEach(e=>{"section"!==e.type&&"description"!==e.type||l["!merges"].push({s:{r:e.row,c:0},e:{r:e.row,c:5}})});const f=s.Wp.book_new();s.Wp.book_append_sheet(f,l,"Seznam Dokumentov"),s._h(f,"DZO_Dokumenti_Seznam.xlsx")}}}]);
//# sourceMappingURL=816.8ea14713.chunk.js.map