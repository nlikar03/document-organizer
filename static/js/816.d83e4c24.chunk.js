"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[816],{816:(e,t,o)=>{o.d(t,{downloadExcelClientSide:()=>l,downloadZipClientSide:()=>r});var n=o(159),a=o.n(n),d=o(105),i=o(238),s=o(611);const c=async(e,t)=>{try{const o=await d.PDFDocument.load(e),n=o.getPages();if(0===n.length)return e;const a=n[0],{width:i,height:s}=a.getSize(),c=a.getRotation().angle,r=await o.embedFont(d.StandardFonts.HelveticaBold),l=20,u=r.widthOfTextAtSize(t,l),m=30;return a.drawText(t,{x:i-u-m,y:s-m-15,size:l,font:r,color:(0,d.rgb)(1,0,0),rotate:(0,d.degrees)(c)}),await o.save()}catch(o){return console.error("Watermark error:",o),e}},r=async(e,t)=>{const o=new(a()),n={};for(const a of t){const e=[],d=a.id.split(".");for(let o=0;o<d.length;o++){const n=d.slice(0,o+1).join("."),a=t.find(e=>e.id===n);a&&e.push(a.name)}const i=e.join("/");n[a.id]=i,o.folder(i)}for(const a of e){const e=await(0,s._i)(a.fileName);if(!e)continue;let t=await e.arrayBuffer();e.name.toLowerCase().endsWith(".pdf")&&(t=await c(t,a.docCode));const d=e.name.substring(0,e.name.lastIndexOf(".")),i=e.name.substring(e.name.lastIndexOf(".")),r="".concat(String(a.fileNumber).padStart(3,"0"),"_").concat(d).concat(i),l="".concat(n[a.suggestedFolder.id],"/").concat(r);o.file(l,t)}const d=await o.generateAsync({type:"blob"}),i=window.URL.createObjectURL(d),r=document.createElement("a");r.href=i,r.download="DZO_Dokumenti.zip",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r)},l=async(e,t)=>{const o=e=>{const o=[],n=e.split(".");for(let a=0;a<n.length;a++){const e=n.slice(0,a+1).join("."),d=t.find(t=>t.id===e);d&&o.push(d.name)}return o.join(" / ")},n=[...e].sort((e,t)=>e.suggestedFolder.id.localeCompare(t.suggestedFolder.id)),a=[["Zap. \u0161t.","Ime dokazila oz. na kaj se dokazilo nana\u0161a","Izdajatelj","\u0160t. dokazila","Datum","Kategorija","Koda dokumenta"]];for(const i of n)a.push([i.fileNumber,i.documentTitle||"",i.issuer||"",i.documentNumber||"",i.date||"",o(i.suggestedFolder.id),i.docCode]);const d=i.Wp.aoa_to_sheet(a),s=i.Wp.book_new();i.Wp.book_append_sheet(s,d,"Seznam Dokumentov"),i._h(s,"DZO_Dokumenti_Seznam.xlsx")}}}]);
//# sourceMappingURL=816.d83e4c24.chunk.js.map