{"version":3,"file":"static/js/816.5edb00c8.chunk.js","mappings":"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","sources":["clientDownloads.js"],"sourcesContent":["import JSZip from 'jszip';\r\nimport { PDFDocument, rgb, StandardFonts, degrees } from 'pdf-lib';\r\nimport * as XLSX from 'xlsx';\r\nimport { getFileFromIndexedDB } from './indexedDBHelper';\r\n\r\nexport const addWatermarkToPDF = async (pdfBytes, watermarkText) => {\r\n  try {\r\n    const pdfDoc = await PDFDocument.load(pdfBytes);\r\n    const pages = pdfDoc.getPages();\r\n    if (pages.length === 0) return pdfBytes;\r\n\r\n    const firstPage = pages[0];\r\n    \r\n    const { width, height } = firstPage.getSize();\r\n    const rotationAngle = firstPage.getRotation().angle;\r\n\r\n    const font = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\r\n    const fontSize = 20;\r\n    const textWidth = font.widthOfTextAtSize(watermarkText, fontSize);\r\n    \r\n    const margin = 30;\r\n\r\n\r\n    firstPage.drawText(watermarkText, {\r\n      x: width - textWidth - margin, \r\n      y: height - margin - 15, \r\n      size: fontSize,\r\n      font: font,\r\n      color: rgb(1, 0, 0),\r\n      rotate: degrees(rotationAngle), \r\n    });\r\n\r\n    return await pdfDoc.save();\r\n  } catch (error) {\r\n    console.error('Watermark error:', error);\r\n    return pdfBytes;\r\n  }\r\n};\r\n\r\nexport const downloadZipClientSide = async (finalResults, folders) => {\r\n  const zip = new JSZip();\r\n  \r\n  // Create folder structure\r\n  const folderPaths = {};\r\n  for (const folder of folders) {\r\n    const parts = [];\r\n    const ids = folder.id.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const fid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === fid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    const path = parts.join('/');\r\n    folderPaths[folder.id] = path;\r\n    zip.folder(path);\r\n  }\r\n  \r\n  // Add files\r\n  for (const result of finalResults) {\r\n    const file = await getFileFromIndexedDB(result.fileName);\r\n    if (!file) continue;\r\n    \r\n    let fileBytes = await file.arrayBuffer();\r\n    \r\n    // Add watermark to PDFs\r\n    if (file.name.toLowerCase().endsWith('.pdf')) {\r\n      fileBytes = await addWatermarkToPDF(fileBytes, result.docCode);\r\n    }\r\n    \r\n    const base = file.name.substring(0, file.name.lastIndexOf('.'));\r\n    const ext = file.name.substring(file.name.lastIndexOf('.'));\r\n    const newName = `${String(result.fileNumber).padStart(3, '0')}_${base}${ext}`;\r\n    const path = `${folderPaths[result.suggestedFolder.id]}/${newName}`;\r\n    \r\n    zip.file(path, fileBytes);\r\n  }\r\n  \r\n  const blob = await zip.generateAsync({ type: 'blob' });\r\n  const url = window.URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = 'DZO_Dokumenti.zip';\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  window.URL.revokeObjectURL(url);\r\n  document.body.removeChild(a);\r\n};\r\n\r\nexport const downloadExcelClientSide = async (finalResults, folders) => {\r\n  \r\n  const buildFolderPath = (folderId) => {\r\n    const parts = [];\r\n    const ids = folderId.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const pid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === pid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    return parts.join(' / ');\r\n  };\r\n  \r\n  const sorted = [...finalResults].sort((a, b) => \r\n    a.suggestedFolder.id.localeCompare(b.suggestedFolder.id)\r\n  );\r\n  \r\n  const data = [\r\n    ['Zap. št.', 'Originalno ime', 'Ime dokazila oz. na kaj se dokazilo nanaša', 'Izdajatelj', 'Št. dokazila', 'Datum', 'Kategorija', 'Koda dokumenta']\r\n  ];\r\n  \r\n  for (const res of sorted) {\r\n    data.push([\r\n      res.fileNumber,\r\n      res.fileName,\r\n      res.documentTitle || '',\r\n      res.issuer || '',\r\n      res.documentNumber || '',\r\n      res.date || '',\r\n      buildFolderPath(res.suggestedFolder.id),\r\n      res.docCode\r\n    ]);\r\n  }\r\n  \r\n  const ws = XLSX.utils.aoa_to_sheet(data);\r\n  const wb = XLSX.utils.book_new();\r\n  XLSX.utils.book_append_sheet(wb, ws, 'Seznam Dokumentov');\r\n  XLSX.writeFile(wb, 'DZO_Dokumenti_Seznam.xlsx');\r\n};"],"names":["addWatermarkToPDF","async","pdfBytes","watermarkText","pdfDoc","PDFDocument","load","pages","getPages","length","firstPage","width","height","getSize","rotationAngle","getRotation","angle","font","embedFont","StandardFonts","HelveticaBold","fontSize","textWidth","widthOfTextAtSize","margin","drawText","x","y","size","color","rgb","rotate","degrees","save","error","console","downloadZipClientSide","finalResults","folders","zip","JSZip","folderPaths","folder","parts","ids","id","split","i","fid","slice","join","f","find","push","name","path","result","file","getFileFromIndexedDB","fileName","fileBytes","arrayBuffer","toLowerCase","endsWith","docCode","base","substring","lastIndexOf","ext","newName","concat","String","fileNumber","padStart","suggestedFolder","blob","generateAsync","type","url","window","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","revokeObjectURL","removeChild","downloadExcelClientSide","buildFolderPath","folderId","pid","sorted","sort","b","localeCompare","data","res","documentTitle","issuer","documentNumber","date","ws","XLSX","aoa_to_sheet","wb","book_new","book_append_sheet"],"ignoreList":[],"sourceRoot":""}