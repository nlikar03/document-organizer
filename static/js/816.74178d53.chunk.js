"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[816],{816:(e,t,o)=>{o.d(t,{downloadExcelClientSide:()=>h,downloadZipClientSide:()=>d});var n=o(555),a=o(159),c=o.n(a),s=o(105),r=o(238),i=o(611);const l=async(e,t)=>{try{const o=await s.PDFDocument.load(e),n=o.getPages();if(0===n.length)return e;const a=n[0],{width:c,height:r}=a.getSize(),i=a.getRotation().angle%360,l=await o.embedFont(s.StandardFonts.HelveticaBold),d=20,h=30,u=l.widthOfTextAtSize(t,d),f=d;let p,m;switch(i){case 90:p=h+f,m=r-h-u;break;case 180:p=h+u,m=h;break;case 270:p=c-h-f,m=h+u;break;default:p=c-u-h,m=r-h-f}return a.drawText(t,{x:p,y:m,size:d,font:l,color:(0,s.rgb)(1,0,0),rotate:(0,s.degrees)(i)}),await o.save()}catch(o){return console.error("Watermark error:",o),e}},d=async(e,t)=>{const o=new(c()),n={};for(const c of t){const e=[],a=c.id.split(".");for(let o=0;o<a.length;o++){const n=a.slice(0,o+1).join("."),c=t.find(e=>e.id===n);c&&e.push(c.name)}const s=e.join("/");n[c.id]=s,o.folder(s)}for(const c of e){const e=await(0,i.getFileFromIndexedDB)(c.fileName);if(!e)continue;let t=await e.arrayBuffer();e.name.toLowerCase().endsWith(".pdf")&&(t=await l(t,c.docCode));const a=e.name.substring(0,e.name.lastIndexOf(".")),s=e.name.substring(e.name.lastIndexOf(".")),r="".concat(String(c.fileNumber).padStart(3,"0"),"_").concat(a).concat(s),d="".concat(n[c.suggestedFolder.id],"/").concat(r);o.file(d,t)}const a=await o.generateAsync({type:"blob"}),s=window.URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download="DZO_Dokumenti.zip",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)},h=async(e,t)=>{const o=[...e].sort((e,t)=>e.suggestedFolder.id.localeCompare(t.suggestedFolder.id)),a={};o.forEach(e=>{const o=(e=>{const o=[],n=e.split(".");for(let a=0;a<n.length;a++){const e=n.slice(0,a+1).join("."),c=t.find(t=>t.id===e);c&&o.push(c.name)}return o})(e.suggestedFolder.id),c=o[0]||"Neznano";a[c]||(a[c]=[]),a[c].push((0,n.A)((0,n.A)({},e),{},{__pathArr:o}))});const c=[];c.push(["Zap. \u0161t.","Originalno ime","Ime dokazila oz. na kaj se dokazilo nana\u0161a","Izdajatelj","\u0160t. dokazila","Datum","Kategorija","Koda dokumenta"]);const s=[];Object.keys(a).sort().forEach(e=>{const t=c.length;c.push([e.toUpperCase(),"","","","","","",""]),s.push({row:t,type:"section"});let o=null;a[e].forEach(e=>{const t=e.__pathArr[1];if(t&&t!==o){o=t;const e=c.length;c.push(["- ".concat(t),"","","","","","",""]),s.push({row:e,type:"sub"})}c.push([e.fileNumber,e.fileName,e.documentTitle||"",e.issuer||"",e.documentNumber||"",e.date||"",e.__pathArr.join(" / "),e.docCode])}),c.push(["","","","","","","",""])});const i=r.Wp.aoa_to_sheet(c);s.forEach(e=>{for(let t=0;t<8;t++){const o=r.Wp.encode_cell({r:e.row,c:t});i[o]&&("section"===e.type&&(i[o].s={font:{bold:!0,sz:13},fill:{fgColor:{rgb:"FFF2CC"}},alignment:{vertical:"center"}}),"sub"===e.type&&(i[o].s={font:{bold:!0,italic:!0},fill:{fgColor:{rgb:"E7F3FF"}},alignment:{vertical:"center"}}))}}),i["!cols"]=[{wch:10},{wch:25},{wch:45},{wch:28},{wch:18},{wch:14},{wch:35},{wch:18}];const l=r.Wp.book_new();r.Wp.book_append_sheet(l,i,"Seznam Dokumentov"),r._h(l,"DZO_Dokumenti_Seznam.xlsx")}}}]);
//# sourceMappingURL=816.74178d53.chunk.js.map