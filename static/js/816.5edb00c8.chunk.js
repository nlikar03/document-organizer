"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[816],{816:(e,t,o)=>{o.d(t,{downloadExcelClientSide:()=>l,downloadZipClientSide:()=>c});var n=o(159),a=o.n(n),i=o(105),d=o(238),s=o(611);const r=async(e,t)=>{try{const o=await i.PDFDocument.load(e),n=o.getPages();if(0===n.length)return e;const a=n[0],{width:d,height:s}=a.getSize(),r=a.getRotation().angle,c=await o.embedFont(i.StandardFonts.HelveticaBold),l=20,u=c.widthOfTextAtSize(t,l),m=30;return a.drawText(t,{x:d-u-m,y:s-m-15,size:l,font:c,color:(0,i.rgb)(1,0,0),rotate:(0,i.degrees)(r)}),await o.save()}catch(o){return console.error("Watermark error:",o),e}},c=async(e,t)=>{const o=new(a()),n={};for(const a of t){const e=[],i=a.id.split(".");for(let o=0;o<i.length;o++){const n=i.slice(0,o+1).join("."),a=t.find(e=>e.id===n);a&&e.push(a.name)}const d=e.join("/");n[a.id]=d,o.folder(d)}for(const a of e){const e=await(0,s._i)(a.fileName);if(!e)continue;let t=await e.arrayBuffer();e.name.toLowerCase().endsWith(".pdf")&&(t=await r(t,a.docCode));const i=e.name.substring(0,e.name.lastIndexOf(".")),d=e.name.substring(e.name.lastIndexOf(".")),c="".concat(String(a.fileNumber).padStart(3,"0"),"_").concat(i).concat(d),l="".concat(n[a.suggestedFolder.id],"/").concat(c);o.file(l,t)}const i=await o.generateAsync({type:"blob"}),d=window.URL.createObjectURL(i),c=document.createElement("a");c.href=d,c.download="DZO_Dokumenti.zip",document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(d),document.body.removeChild(c)},l=async(e,t)=>{const o=e=>{const o=[],n=e.split(".");for(let a=0;a<n.length;a++){const e=n.slice(0,a+1).join("."),i=t.find(t=>t.id===e);i&&o.push(i.name)}return o.join(" / ")},n=[...e].sort((e,t)=>e.suggestedFolder.id.localeCompare(t.suggestedFolder.id)),a=[["Zap. \u0161t.","Originalno ime","Ime dokazila oz. na kaj se dokazilo nana\u0161a","Izdajatelj","\u0160t. dokazila","Datum","Kategorija","Koda dokumenta"]];for(const d of n)a.push([d.fileNumber,d.fileName,d.documentTitle||"",d.issuer||"",d.documentNumber||"",d.date||"",o(d.suggestedFolder.id),d.docCode]);const i=d.Wp.aoa_to_sheet(a),s=d.Wp.book_new();d.Wp.book_append_sheet(s,i,"Seznam Dokumentov"),d._h(s,"DZO_Dokumenti_Seznam.xlsx")}}}]);
//# sourceMappingURL=816.5edb00c8.chunk.js.map