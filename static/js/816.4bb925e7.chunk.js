"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[816],{816:(e,t,o)=>{o.d(t,{downloadExcelClientSide:()=>h,downloadZipClientSide:()=>d});var n=o(555),r=o(159),a=o.n(r),c=o(105),s=o(238),i=o(611);const l=async(e,t)=>{try{const o=await c.PDFDocument.load(e),n=o.getPages();if(0===n.length)return e;const r=n[0],{width:a,height:s}=r.getSize(),i=r.getRotation().angle%360,l=await o.embedFont(c.StandardFonts.HelveticaBold),d=20,h=30,f=l.widthOfTextAtSize(t,d),p=d;let u,m;switch(i){case 90:u=h+p,m=s-h-f;break;case 180:u=h+f,m=h;break;case 270:u=a-h-p,m=h+f;break;default:u=a-f-h,m=s-h-p}return r.drawText(t,{x:u,y:m,size:d,font:l,color:(0,c.rgb)(1,0,0),rotate:(0,c.degrees)(i)}),await o.save()}catch(o){return console.error("Watermark error:",o),e}},d=async(e,t)=>{const o=new(a()),n={};for(const a of t){const e=[],r=a.id.split(".");for(let o=0;o<r.length;o++){const n=r.slice(0,o+1).join("."),a=t.find(e=>e.id===n);a&&e.push(a.name)}const c=e.join("/");n[a.id]=c,o.folder(c)}for(const a of e){const e=await(0,i.getFileFromIndexedDB)(a.fileName);if(!e)continue;let t=await e.arrayBuffer();e.name.toLowerCase().endsWith(".pdf")&&(t=await l(t,a.docCode));const r=e.name.substring(0,e.name.lastIndexOf(".")),c=e.name.substring(e.name.lastIndexOf(".")),s="".concat(String(a.fileNumber).padStart(3,"0"),"_").concat(r).concat(c),d="".concat(n[a.suggestedFolder.id],"/").concat(s);o.file(d,t)}const r=await o.generateAsync({type:"blob"}),c=window.URL.createObjectURL(r),s=document.createElement("a");s.href=c,s.download="DZO_Dokumenti.zip",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(c),document.body.removeChild(s)},h=async(e,t)=>{const o=[...e].sort((e,t)=>e.suggestedFolder.id.localeCompare(t.suggestedFolder.id)),r={};o.forEach(e=>{const o=(e=>{const o=[],n=e.split(".");for(let r=0;r<n.length;r++){const e=n.slice(0,r+1).join("."),a=t.find(t=>t.id===e);a&&o.push(a.name)}return o})(e.suggestedFolder.id),a=o[0]||"Neznano";r[a]||(r[a]=[]),r[a].push((0,n.A)((0,n.A)({},e),{},{__pathArr:o}))});const a=[],c=[];let i=0;Object.keys(r).sort().forEach((e,t)=>{const o=i;a.push([e,"","","","",""]),c.push({row:o,type:"section"}),i++;const n=i;a.push(["zap. \u0161t.","ime dokazila oz. na kaj se dokazilo nana\u0161a","Izdajatelj","\u0161t. dokazila","datum",""]),c.push({row:n,type:"header"}),i++;let s=1;r[e].forEach(e=>{a.push([s++,e.documentTitle||e.fileName,e.issuer||"",e.documentNumber||"",e.date||"",""]),i++}),a.push(["","","","","",""]),i++});const l=s.Wp.aoa_to_sheet(a);c.forEach(e=>{const t=s.Wp.encode_cell({r:e.row,c:0});if("section"===e.type&&(l[t].s={font:{bold:!0,sz:11},alignment:{horizontal:"left",vertical:"center"}}),"description"===e.type&&(l[t].s={font:{italic:!0,sz:9},alignment:{horizontal:"left",vertical:"center",wrapText:!0}}),"header"===e.type)for(let o=0;o<6;o++){const t=s.Wp.encode_cell({r:e.row,c:o});l[t]&&(l[t].s={font:{bold:!0,sz:10},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}}}})}}),a.forEach((e,t)=>{if(!c.some(e=>e.row===t))for(let o=0;o<6;o++){const e=s.Wp.encode_cell({r:t,c:o});l[e]&&(l[e].s={border:{left:{style:"dotted",color:{rgb:"CCCCCC"}},right:{style:"dotted",color:{rgb:"CCCCCC"}},bottom:{style:"dotted",color:{rgb:"CCCCCC"}}}})}}),l["!cols"]=[{wch:8},{wch:45},{wch:35},{wch:20},{wch:12},{wch:5}],l["!merges"]||(l["!merges"]=[]),c.forEach(e=>{"section"!==e.type&&"description"!==e.type||l["!merges"].push({s:{r:e.row,c:0},e:{r:e.row,c:5}})});const d=s.Wp.book_new();s.Wp.book_append_sheet(d,l,"Seznam Dokumentov"),s._h(d,"DZO_Dokumenti_Seznam.xlsx")}}}]);
//# sourceMappingURL=816.4bb925e7.chunk.js.map