{"version":3,"file":"static/js/816.74178d53.chunk.js","mappings":"+NAKO,MAAMA,EAAoBC,MAAOC,EAAUC,KAChD,IACE,MAAMC,QAAeC,EAAAA,YAAYC,KAAKJ,GAChCK,EAAQH,EAAOI,WACrB,GAAqB,IAAjBD,EAAME,OAAc,OAAOP,EAE/B,MAAMQ,EAAOH,EAAM,IACb,MAAEI,EAAK,OAAEC,GAAWF,EAAKG,UACzBC,EAAWJ,EAAKK,cAAcC,MAAQ,IAEtCC,QAAab,EAAOc,UAAUC,EAAAA,cAAcC,eAC5CC,EAAW,GACXC,EAAS,GACTC,EAAYN,EAAKO,kBAAkBrB,EAAekB,GAClDI,EAAaJ,EAEnB,IAAIK,EAAGC,EAGP,OAAQb,GACN,KAAK,GAEHY,EAAIJ,EAASG,EACbE,EAAIf,EAASU,EAASC,EACtB,MACF,KAAK,IAEHG,EAAIJ,EAASC,EACbI,EAAIL,EACJ,MACF,KAAK,IAEHI,EAAIf,EAAQW,EAASG,EACrBE,EAAIL,EAASC,EACb,MAEF,QAEEG,EAAIf,EAAQY,EAAYD,EACxBK,EAAIf,EAASU,EAASG,EAa1B,OATAf,EAAKkB,SAASzB,EAAe,CAC3BuB,IACAC,IACAE,KAAMR,EACNJ,OACAa,OAAOC,EAAAA,EAAAA,KAAI,EAAG,EAAG,GACjBC,QAAQC,EAAAA,EAAAA,SAAQnB,WAGLV,EAAO8B,MACtB,CAAE,MAAOC,GAEP,OADAC,QAAQD,MAAM,mBAAoBA,GAC3BjC,CACT,GAGWmC,EAAwBpC,MAAOqC,EAAcC,KACxD,MAAMC,EAAM,IAAIC,KAEVC,EAAc,CAAC,EACrB,IAAK,MAAMC,KAAUJ,EAAS,CAC5B,MAAMK,EAAQ,GACRC,EAAMF,EAAOG,GAAGC,MAAM,KAC5B,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAIpC,OAAQuC,IAAK,CACnC,MAAMC,EAAMJ,EAAIK,MAAM,EAAGF,EAAI,GAAGG,KAAK,KAC/BC,EAAIb,EAAQc,KAAK3B,GAAKA,EAAEoB,KAAOG,GACjCG,GAAGR,EAAMU,KAAKF,EAAEG,KACtB,CACA,MAAMC,EAAOZ,EAAMO,KAAK,KACxBT,EAAYC,EAAOG,IAAMU,EACzBhB,EAAIG,OAAOa,EACb,CAEA,IAAK,MAAMC,KAAUnB,EAAc,CACjC,MAAMoB,QAAaC,EAAAA,EAAAA,sBAAqBF,EAAOG,UAC/C,IAAKF,EAAM,SAEX,IAAIG,QAAkBH,EAAKI,cAEvBJ,EAAKH,KAAKQ,cAAcC,SAAS,UACnCH,QAAkB7D,EAAkB6D,EAAWJ,EAAOQ,UAGxD,MAAMC,EAAOR,EAAKH,KAAKY,UAAU,EAAGT,EAAKH,KAAKa,YAAY,MACpDC,EAAMX,EAAKH,KAAKY,UAAUT,EAAKH,KAAKa,YAAY,MAChDE,EAAO,GAAAC,OAAMC,OAAOf,EAAOgB,YAAYC,SAAS,EAAG,KAAI,KAAAH,OAAIL,GAAIK,OAAGF,GAClEb,EAAI,GAAAe,OAAM7B,EAAYe,EAAOkB,gBAAgB7B,IAAG,KAAAyB,OAAID,GAE1D9B,EAAIkB,KAAKF,EAAMK,EACjB,CAEA,MAAMe,QAAapC,EAAIqC,cAAc,CAAEC,KAAM,SACvCC,EAAMC,OAAOC,IAAIC,gBAAgBN,GACjCO,EAAIC,SAASC,cAAc,KACjCF,EAAEG,KAAOP,EACTI,EAAEI,SAAW,oBACbH,SAASI,KAAKC,YAAYN,GAC1BA,EAAEO,QACFV,OAAOC,IAAIU,gBAAgBZ,GAC3BK,SAASI,KAAKI,YAAYT,IAGfU,EAA0B5F,MAAOqC,EAAcC,KAC1D,MAYMuD,EAAS,IAAIxD,GAAcyD,KAAK,CAACZ,EAAGa,IACxCb,EAAER,gBAAgB7B,GAAGmD,cAAcD,EAAErB,gBAAgB7B,KAIjDoD,EAAU,CAAC,EACjBJ,EAAOK,QAAQC,IACb,MAAMC,EAnBiBC,KACvB,MAAM1D,EAAQ,GACRC,EAAMyD,EAASvD,MAAM,KAC3B,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAIpC,OAAQuC,IAAK,CACnC,MAAMuD,EAAM1D,EAAIK,MAAM,EAAGF,EAAI,GAAGG,KAAK,KAC/BC,EAAIb,EAAQc,KAAK3B,GAAKA,EAAEoB,KAAOyD,GACjCnD,GAAGR,EAAMU,KAAKF,EAAEG,KACtB,CACA,OAAOX,GAWS4D,CAAgBJ,EAAIzB,gBAAgB7B,IAC9C2D,EAAYJ,EAAQ,IAAM,UAC3BH,EAAQO,KAAYP,EAAQO,GAAa,IAC9CP,EAAQO,GAAWnD,MAAIoD,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAC,CAAC,EAAIN,GAAG,IAAEO,UAAWN,OAG/C,MAAMO,EAAO,GAGbA,EAAKtD,KAAK,CACR,gBACA,iBACA,kDACA,aACA,oBACA,QACA,aACA,mBAGF,MAAMuD,EAAmB,GAEzBC,OAAOC,KAAKb,GAASH,OAAOI,QAAQM,IAElC,MAAMO,EAAkBJ,EAAKnG,OAC7BmG,EAAKtD,KAAK,CAACmD,EAAUQ,cAAe,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,KAC5DJ,EAAiBvD,KAAK,CAAE4D,IAAKF,EAAiBlC,KAAM,YAEpD,IAAIqC,EAAa,KAEjBjB,EAAQO,GAAWN,QAAQC,IACzB,MAAMgB,EAAYhB,EAAIO,UAAU,GAGhC,GAAIS,GAAaA,IAAcD,EAAY,CACzCA,EAAaC,EACb,MAAMC,EAAcT,EAAKnG,OACzBmG,EAAKtD,KAAK,CAAC,KAADiB,OAAM6C,GAAa,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,KACrDP,EAAiBvD,KAAK,CAAE4D,IAAKG,EAAavC,KAAM,OAClD,CAGA8B,EAAKtD,KAAK,CACR8C,EAAI3B,WACJ2B,EAAIxC,SACJwC,EAAIkB,eAAiB,GACrBlB,EAAImB,QAAU,GACdnB,EAAIoB,gBAAkB,GACtBpB,EAAIqB,MAAQ,GACZrB,EAAIO,UAAUxD,KAAK,OACnBiD,EAAInC,YAKR2C,EAAKtD,KAAK,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,OAGzC,MAAMoE,EAAKC,EAAAA,GAAWC,aAAahB,GAGnCC,EAAiBV,QAAQ0B,IACvB,IAAK,IAAIC,EAAM,EAAGA,EAAM,EAAGA,IAAO,CAChC,MAAMC,EAAcJ,EAAAA,GAAWK,YAAY,CAAEC,EAAGJ,EAAKX,IAAKgB,EAAGJ,IACxDJ,EAAGK,KAEU,YAAdF,EAAK/C,OACP4C,EAAGK,GAAaI,EAAI,CAClBlH,KAAM,CAAEmH,MAAM,EAAMC,GAAI,IACxBC,KAAM,CAAEC,QAAS,CAAExG,IAAK,WACxByG,UAAW,CAAEC,SAAU,YAIT,QAAdZ,EAAK/C,OACP4C,EAAGK,GAAaI,EAAI,CAClBlH,KAAM,CAAEmH,MAAM,EAAMM,QAAQ,GAC5BJ,KAAM,CAAEC,QAAS,CAAExG,IAAK,WACxByG,UAAW,CAAEC,SAAU,YAG7B,IAIFf,EAAG,SAAW,CACZ,CAAEiB,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,IACP,CAAEA,IAAK,KAGT,MAAMC,EAAKjB,EAAAA,GAAWkB,WACtBlB,EAAAA,GAAWmB,kBAAkBF,EAAIlB,EAAI,qBACrCC,EAAAA,GAAeiB,EAAI,6B","sources":["clientDownloads.js"],"sourcesContent":["import JSZip from 'jszip';\r\nimport { PDFDocument, rgb, StandardFonts, degrees } from 'pdf-lib';\r\nimport * as XLSX from 'xlsx';\r\nimport { getFileFromIndexedDB } from './indexedDBHelper';\r\n\r\nexport const addWatermarkToPDF = async (pdfBytes, watermarkText) => {\r\n  try {\r\n    const pdfDoc = await PDFDocument.load(pdfBytes);\r\n    const pages = pdfDoc.getPages();\r\n    if (pages.length === 0) return pdfBytes;\r\n\r\n    const page = pages[0];\r\n    const { width, height } = page.getSize();\r\n    const rotation = page.getRotation().angle % 360;\r\n\r\n    const font = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\r\n    const fontSize = 20;\r\n    const margin = 30;\r\n    const textWidth = font.widthOfTextAtSize(watermarkText, fontSize);\r\n    const textHeight = fontSize; \r\n\r\n    let x, y;\r\n\r\n    // Logic for VISUAL Top-Right based on internal rotation\r\n    switch (rotation) {\r\n      case 90:\r\n        // Page is rotated 90 deg CCW internally\r\n        x = margin + textHeight; \r\n        y = height - margin - textWidth;\r\n        break;\r\n      case 180:\r\n        // Page is upside down internally\r\n        x = margin + textWidth;\r\n        y = margin;\r\n        break;\r\n      case 270:\r\n        // Page is rotated 270 deg CCW internally\r\n        x = width - margin - textHeight;\r\n        y = margin + textWidth;\r\n        break;\r\n      case 0:\r\n      default:\r\n        // Standard orientation\r\n        x = width - textWidth - margin;\r\n        y = height - margin - textHeight;\r\n        break;\r\n    }\r\n\r\n    page.drawText(watermarkText, {\r\n      x,\r\n      y,\r\n      size: fontSize,\r\n      font,\r\n      color: rgb(1, 0, 0), // Red\r\n      rotate: degrees(rotation), \r\n    });\r\n\r\n    return await pdfDoc.save();\r\n  } catch (error) {\r\n    console.error('Watermark error:', error);\r\n    return pdfBytes;\r\n  }\r\n};\r\n\r\nexport const downloadZipClientSide = async (finalResults, folders) => {\r\n  const zip = new JSZip();\r\n  \r\n  const folderPaths = {};\r\n  for (const folder of folders) {\r\n    const parts = [];\r\n    const ids = folder.id.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const fid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === fid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    const path = parts.join('/');\r\n    folderPaths[folder.id] = path;\r\n    zip.folder(path);\r\n  }\r\n  \r\n  for (const result of finalResults) {\r\n    const file = await getFileFromIndexedDB(result.fileName);\r\n    if (!file) continue;\r\n    \r\n    let fileBytes = await file.arrayBuffer();\r\n    \r\n    if (file.name.toLowerCase().endsWith('.pdf')) {\r\n      fileBytes = await addWatermarkToPDF(fileBytes, result.docCode);\r\n    }\r\n    \r\n    const base = file.name.substring(0, file.name.lastIndexOf('.'));\r\n    const ext = file.name.substring(file.name.lastIndexOf('.'));\r\n    const newName = `${String(result.fileNumber).padStart(3, '0')}_${base}${ext}`;\r\n    const path = `${folderPaths[result.suggestedFolder.id]}/${newName}`;\r\n    \r\n    zip.file(path, fileBytes);\r\n  }\r\n  \r\n  const blob = await zip.generateAsync({ type: 'blob' });\r\n  const url = window.URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = 'DZO_Dokumenti.zip';\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  window.URL.revokeObjectURL(url);\r\n  document.body.removeChild(a);\r\n};\r\n\r\nexport const downloadExcelClientSide = async (finalResults, folders) => {\r\n  const buildFolderPath = (folderId) => {\r\n    const parts = [];\r\n    const ids = folderId.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const pid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === pid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    return parts;\r\n  };\r\n\r\n  // Sort by folder hierarchy\r\n  const sorted = [...finalResults].sort((a, b) =>\r\n    a.suggestedFolder.id.localeCompare(b.suggestedFolder.id)\r\n  );\r\n\r\n  // Group by top-level folder\r\n  const grouped = {};\r\n  sorted.forEach(res => {\r\n    const pathArr = buildFolderPath(res.suggestedFolder.id);\r\n    const topFolder = pathArr[0] || 'Neznano';\r\n    if (!grouped[topFolder]) grouped[topFolder] = [];\r\n    grouped[topFolder].push({ ...res, __pathArr: pathArr });\r\n  });\r\n\r\n  const data = [];\r\n\r\n  // Column headers (UNCHANGED)\r\n  data.push([\r\n    'Zap. št.',\r\n    'Originalno ime',\r\n    'Ime dokazila oz. na kaj se dokazilo nanaša',\r\n    'Izdajatelj',\r\n    'Št. dokazila',\r\n    'Datum',\r\n    'Kategorija',\r\n    'Koda dokumenta'\r\n  ]);\r\n\r\n  const folderRowIndexes = [];\r\n\r\n  Object.keys(grouped).sort().forEach(topFolder => {\r\n    // === MAIN SECTION HEADER (like roman numeral section) ===\r\n    const sectionRowIndex = data.length;\r\n    data.push([topFolder.toUpperCase(), '', '', '', '', '', '', '']);\r\n    folderRowIndexes.push({ row: sectionRowIndex, type: 'section' });\r\n\r\n    let currentSub = null;\r\n\r\n    grouped[topFolder].forEach(res => {\r\n      const subFolder = res.__pathArr[1]; // second level folder\r\n\r\n      // === SUBTITLE ROW (like description row) ===\r\n      if (subFolder && subFolder !== currentSub) {\r\n        currentSub = subFolder;\r\n        const subRowIndex = data.length;\r\n        data.push([`- ${subFolder}`, '', '', '', '', '', '', '']);\r\n        folderRowIndexes.push({ row: subRowIndex, type: 'sub' });\r\n      }\r\n\r\n      // === NORMAL ITEM ROW (DATA) ===\r\n      data.push([\r\n        res.fileNumber,\r\n        res.fileName,\r\n        res.documentTitle || '',\r\n        res.issuer || '',\r\n        res.documentNumber || '',\r\n        res.date || '',\r\n        res.__pathArr.join(' / '),\r\n        res.docCode\r\n      ]);\r\n    });\r\n\r\n    // spacing row\r\n    data.push(['', '', '', '', '', '', '', '']);\r\n  });\r\n\r\n  const ws = XLSX.utils.aoa_to_sheet(data);\r\n\r\n  // ===== STYLING =====\r\n  folderRowIndexes.forEach(info => {\r\n    for (let col = 0; col < 8; col++) {\r\n      const cellAddress = XLSX.utils.encode_cell({ r: info.row, c: col });\r\n      if (!ws[cellAddress]) continue;\r\n\r\n      if (info.type === 'section') {\r\n        ws[cellAddress].s = {\r\n          font: { bold: true, sz: 13 },\r\n          fill: { fgColor: { rgb: 'FFF2CC' } }, // light yellow\r\n          alignment: { vertical: 'center' }\r\n        };\r\n      }\r\n\r\n      if (info.type === 'sub') {\r\n        ws[cellAddress].s = {\r\n          font: { bold: true, italic: true },\r\n          fill: { fgColor: { rgb: 'E7F3FF' } }, // light blue\r\n          alignment: { vertical: 'center' }\r\n        };\r\n      }\r\n    }\r\n  });\r\n\r\n  // Column widths\r\n  ws['!cols'] = [\r\n    { wch: 10 },\r\n    { wch: 25 },\r\n    { wch: 45 },\r\n    { wch: 28 },\r\n    { wch: 18 },\r\n    { wch: 14 },\r\n    { wch: 35 },\r\n    { wch: 18 }\r\n  ];\r\n\r\n  const wb = XLSX.utils.book_new();\r\n  XLSX.utils.book_append_sheet(wb, ws, 'Seznam Dokumentov');\r\n  XLSX.writeFile(wb, 'DZO_Dokumenti_Seznam.xlsx');\r\n};"],"names":["addWatermarkToPDF","async","pdfBytes","watermarkText","pdfDoc","PDFDocument","load","pages","getPages","length","page","width","height","getSize","rotation","getRotation","angle","font","embedFont","StandardFonts","HelveticaBold","fontSize","margin","textWidth","widthOfTextAtSize","textHeight","x","y","drawText","size","color","rgb","rotate","degrees","save","error","console","downloadZipClientSide","finalResults","folders","zip","JSZip","folderPaths","folder","parts","ids","id","split","i","fid","slice","join","f","find","push","name","path","result","file","getFileFromIndexedDB","fileName","fileBytes","arrayBuffer","toLowerCase","endsWith","docCode","base","substring","lastIndexOf","ext","newName","concat","String","fileNumber","padStart","suggestedFolder","blob","generateAsync","type","url","window","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","revokeObjectURL","removeChild","downloadExcelClientSide","sorted","sort","b","localeCompare","grouped","forEach","res","pathArr","folderId","pid","buildFolderPath","topFolder","_objectSpread","__pathArr","data","folderRowIndexes","Object","keys","sectionRowIndex","toUpperCase","row","currentSub","subFolder","subRowIndex","documentTitle","issuer","documentNumber","date","ws","XLSX","aoa_to_sheet","info","col","cellAddress","encode_cell","r","c","s","bold","sz","fill","fgColor","alignment","vertical","italic","wch","wb","book_new","book_append_sheet"],"ignoreList":[],"sourceRoot":""}