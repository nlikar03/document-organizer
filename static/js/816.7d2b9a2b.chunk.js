"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[816],{816:(e,o,t)=>{t.d(o,{downloadExcelClientSide:()=>l,downloadZipClientSide:()=>r});var n=t(159),a=t.n(n),d=t(105),i=t(238),s=t(611);const c=async(e,o)=>{try{const t=await d.PDFDocument.load(e),n=t.getPages()[0],{width:a,height:i}=n.getSize();return n.drawText(o,{x:a-200,y:i-30,size:20,color:(0,d.rgb)(1,0,0)}),await t.save()}catch(t){return console.error("Watermark error:",t),e}},r=async(e,o)=>{const t=new(a()),n={};for(const a of o){const e=[],d=a.id.split(".");for(let t=0;t<d.length;t++){const n=d.slice(0,t+1).join("."),a=o.find(e=>e.id===n);a&&e.push(a.name)}const i=e.join("/");n[a.id]=i,t.folder(i)}for(const a of e){const e=await(0,s._i)(a.fileName);if(!e)continue;let o=await e.arrayBuffer();e.name.toLowerCase().endsWith(".pdf")&&(o=await c(o,a.docCode));const d=e.name.substring(0,e.name.lastIndexOf(".")),i=e.name.substring(e.name.lastIndexOf(".")),r="".concat(String(a.fileNumber).padStart(3,"0"),"_").concat(d).concat(i),l="".concat(n[a.suggestedFolder.id],"/").concat(r);t.file(l,o)}const d=await t.generateAsync({type:"blob"}),i=window.URL.createObjectURL(d),r=document.createElement("a");r.href=i,r.download="DZO_Dokumenti.zip",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r)},l=async(e,o)=>{const t=e=>{const t=[],n=e.split(".");for(let a=0;a<n.length;a++){const e=n.slice(0,a+1).join("."),d=o.find(o=>o.id===e);d&&t.push(d.name)}return t.join(" / ")},n=[...e].sort((e,o)=>e.suggestedFolder.id.localeCompare(o.suggestedFolder.id)),a=[["Zap. \u0161t.","Ime dokazila oz. na kaj se dokazilo nana\u0161a","Izdajatelj","\u0160t. dokazila","Datum","Kategorija","Koda dokumenta"]];for(const i of n)a.push([i.fileNumber,i.documentTitle||"",i.issuer||"",i.documentNumber||"",i.date||"",t(i.suggestedFolder.id),i.docCode]);const d=i.Wp.aoa_to_sheet(a),s=i.Wp.book_new();i.Wp.book_append_sheet(s,d,"Seznam Dokumentov"),i._h(s,"DZO_Dokumenti_Seznam.xlsx")}}}]);
//# sourceMappingURL=816.7d2b9a2b.chunk.js.map