{"version":3,"file":"static/js/816.4bb925e7.chunk.js","mappings":"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","sources":["clientDownloads.js"],"sourcesContent":["import JSZip from 'jszip';\r\nimport { PDFDocument, rgb, StandardFonts, degrees } from 'pdf-lib';\r\nimport * as XLSX from 'xlsx';\r\nimport { getFileFromIndexedDB } from './indexedDBHelper';\r\n\r\nexport const addWatermarkToPDF = async (pdfBytes, watermarkText) => {\r\n  try {\r\n    const pdfDoc = await PDFDocument.load(pdfBytes);\r\n    const pages = pdfDoc.getPages();\r\n    if (pages.length === 0) return pdfBytes;\r\n\r\n    const page = pages[0];\r\n    const { width, height } = page.getSize();\r\n    const rotation = page.getRotation().angle % 360;\r\n\r\n    const font = await pdfDoc.embedFont(StandardFonts.HelveticaBold);\r\n    const fontSize = 20;\r\n    const margin = 30;\r\n    const textWidth = font.widthOfTextAtSize(watermarkText, fontSize);\r\n    const textHeight = fontSize; \r\n\r\n    let x, y;\r\n\r\n    // Logic for VISUAL Top-Right based on internal rotation\r\n    switch (rotation) {\r\n      case 90:\r\n        // Page is rotated 90 deg CCW internally\r\n        x = margin + textHeight; \r\n        y = height - margin - textWidth;\r\n        break;\r\n      case 180:\r\n        // Page is upside down internally\r\n        x = margin + textWidth;\r\n        y = margin;\r\n        break;\r\n      case 270:\r\n        // Page is rotated 270 deg CCW internally\r\n        x = width - margin - textHeight;\r\n        y = margin + textWidth;\r\n        break;\r\n      case 0:\r\n      default:\r\n        // Standard orientation\r\n        x = width - textWidth - margin;\r\n        y = height - margin - textHeight;\r\n        break;\r\n    }\r\n\r\n    page.drawText(watermarkText, {\r\n      x,\r\n      y,\r\n      size: fontSize,\r\n      font,\r\n      color: rgb(1, 0, 0), // Red\r\n      rotate: degrees(rotation), \r\n    });\r\n\r\n    return await pdfDoc.save();\r\n  } catch (error) {\r\n    console.error('Watermark error:', error);\r\n    return pdfBytes;\r\n  }\r\n};\r\n\r\nexport const downloadZipClientSide = async (finalResults, folders) => {\r\n  const zip = new JSZip();\r\n  \r\n  const folderPaths = {};\r\n  for (const folder of folders) {\r\n    const parts = [];\r\n    const ids = folder.id.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const fid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === fid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    const path = parts.join('/');\r\n    folderPaths[folder.id] = path;\r\n    zip.folder(path);\r\n  }\r\n  \r\n  for (const result of finalResults) {\r\n    const file = await getFileFromIndexedDB(result.fileName);\r\n    if (!file) continue;\r\n    \r\n    let fileBytes = await file.arrayBuffer();\r\n    \r\n    if (file.name.toLowerCase().endsWith('.pdf')) {\r\n      fileBytes = await addWatermarkToPDF(fileBytes, result.docCode);\r\n    }\r\n    \r\n    const base = file.name.substring(0, file.name.lastIndexOf('.'));\r\n    const ext = file.name.substring(file.name.lastIndexOf('.'));\r\n    const newName = `${String(result.fileNumber).padStart(3, '0')}_${base}${ext}`;\r\n    const path = `${folderPaths[result.suggestedFolder.id]}/${newName}`;\r\n    \r\n    zip.file(path, fileBytes);\r\n  }\r\n  \r\n  const blob = await zip.generateAsync({ type: 'blob' });\r\n  const url = window.URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = 'DZO_Dokumenti.zip';\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  window.URL.revokeObjectURL(url);\r\n  document.body.removeChild(a);\r\n};\r\n\r\nexport const downloadExcelClientSide = async (finalResults, folders) => {\r\n  const buildFolderPath = (folderId) => {\r\n    const parts = [];\r\n    const ids = folderId.split('.');\r\n    for (let i = 0; i < ids.length; i++) {\r\n      const pid = ids.slice(0, i + 1).join('.');\r\n      const f = folders.find(x => x.id === pid);\r\n      if (f) parts.push(f.name);\r\n    }\r\n    return parts;\r\n  };\r\n\r\n  const sorted = [...finalResults].sort((a, b) =>\r\n    a.suggestedFolder.id.localeCompare(b.suggestedFolder.id)\r\n  );\r\n\r\n  const grouped = {};\r\n  sorted.forEach(res => {\r\n    const pathArr = buildFolderPath(res.suggestedFolder.id);\r\n    const topFolder = pathArr[0] || 'Neznano';\r\n    if (!grouped[topFolder]) grouped[topFolder] = [];\r\n    grouped[topFolder].push({ ...res, __pathArr: pathArr });\r\n  });\r\n\r\n  const data = [];\r\n  const styleMap = []; // Track rows that need special styling\r\n\r\n  let rowIndex = 0;\r\n\r\n  Object.keys(grouped).sort().forEach((topFolder, sectionIdx) => {\r\n    // === MAIN SECTION HEADER (Roman numeral + title) ===\r\n    const sectionRow = rowIndex;\r\n    data.push([topFolder, '', '', '', '', '']);\r\n    styleMap.push({ row: sectionRow, type: 'section' });\r\n    rowIndex++;\r\n\r\n    \r\n\r\n    // === TABLE HEADERS ===\r\n    const headerRow = rowIndex;\r\n    data.push(['zap. št.', 'ime dokazila oz. na kaj se dokazilo nanaša', 'Izdajatelj', 'št. dokazila', 'datum', '']);\r\n    styleMap.push({ row: headerRow, type: 'header' });\r\n    rowIndex++;\r\n\r\n    // === DATA ROWS ===\r\n    let itemNumber = 1;\r\n    grouped[topFolder].forEach(res => {\r\n      data.push([\r\n        itemNumber++,\r\n        res.documentTitle || res.fileName,\r\n        res.issuer || '',\r\n        res.documentNumber || '',\r\n        res.date || '',\r\n        ''\r\n      ]);\r\n      rowIndex++;\r\n    });\r\n\r\n    // Empty row separator\r\n    data.push(['', '', '', '', '', '']);\r\n    rowIndex++;\r\n  });\r\n\r\n  const ws = XLSX.utils.aoa_to_sheet(data);\r\n\r\n  // ===== STYLING =====\r\n  styleMap.forEach(info => {\r\n    const cellAddress = XLSX.utils.encode_cell({ r: info.row, c: 0 });\r\n    \r\n    if (info.type === 'section') {\r\n      // Bold section header\r\n      ws[cellAddress].s = {\r\n        font: { bold: true, sz: 11 },\r\n        alignment: { horizontal: 'left', vertical: 'center' }\r\n      };\r\n    }\r\n    \r\n    if (info.type === 'description') {\r\n      // Italic description\r\n      ws[cellAddress].s = {\r\n        font: { italic: true, sz: 9 },\r\n        alignment: { horizontal: 'left', vertical: 'center', wrapText: true }\r\n      };\r\n    }\r\n    \r\n    if (info.type === 'header') {\r\n      // Bold headers for all columns\r\n      for (let col = 0; col < 6; col++) {\r\n        const headerCell = XLSX.utils.encode_cell({ r: info.row, c: col });\r\n        if (ws[headerCell]) {\r\n          ws[headerCell].s = {\r\n            font: { bold: true, sz: 10 },\r\n            alignment: { horizontal: 'center', vertical: 'center' },\r\n            border: {\r\n              top: { style: 'thin', color: { rgb: '000000' } },\r\n              bottom: { style: 'thin', color: { rgb: '000000' } }\r\n            }\r\n          };\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  // Add borders to data rows\r\n  data.forEach((row, rowIdx) => {\r\n    if (styleMap.some(s => s.row === rowIdx)) return; // Skip styled rows\r\n    \r\n    for (let col = 0; col < 6; col++) {\r\n      const cellAddr = XLSX.utils.encode_cell({ r: rowIdx, c: col });\r\n      if (ws[cellAddr]) {\r\n        ws[cellAddr].s = {\r\n          border: {\r\n            left: { style: 'dotted', color: { rgb: 'CCCCCC' } },\r\n            right: { style: 'dotted', color: { rgb: 'CCCCCC' } },\r\n            bottom: { style: 'dotted', color: { rgb: 'CCCCCC' } }\r\n          }\r\n        };\r\n      }\r\n    }\r\n  });\r\n\r\n  // Column widths (matching the image proportions)\r\n  ws['!cols'] = [\r\n    { wch: 8 },   // zap. št.\r\n    { wch: 45 },  // ime dokazila\r\n    { wch: 35 },  // izdajatelj\r\n    { wch: 20 },  // št. dokazila\r\n    { wch: 12 },  // datum\r\n    { wch: 5 }    // empty column\r\n  ];\r\n\r\n  // Merge cells for section headers and descriptions\r\n  if (!ws['!merges']) ws['!merges'] = [];\r\n  styleMap.forEach(info => {\r\n    if (info.type === 'section' || info.type === 'description') {\r\n      ws['!merges'].push({\r\n        s: { r: info.row, c: 0 },\r\n        e: { r: info.row, c: 5 }\r\n      });\r\n    }\r\n  });\r\n\r\n  const wb = XLSX.utils.book_new();\r\n  XLSX.utils.book_append_sheet(wb, ws, 'Seznam Dokumentov');\r\n  XLSX.writeFile(wb, 'DZO_Dokumenti_Seznam.xlsx');\r\n};"],"names":["addWatermarkToPDF","async","pdfBytes","watermarkText","pdfDoc","PDFDocument","load","pages","getPages","length","page","width","height","getSize","rotation","getRotation","angle","font","embedFont","StandardFonts","HelveticaBold","fontSize","margin","textWidth","widthOfTextAtSize","textHeight","x","y","drawText","size","color","rgb","rotate","degrees","save","error","console","downloadZipClientSide","finalResults","folders","zip","JSZip","folderPaths","folder","parts","ids","id","split","i","fid","slice","join","f","find","push","name","path","result","file","getFileFromIndexedDB","fileName","fileBytes","arrayBuffer","toLowerCase","endsWith","docCode","base","substring","lastIndexOf","ext","newName","concat","String","fileNumber","padStart","suggestedFolder","blob","generateAsync","type","url","window","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","revokeObjectURL","removeChild","downloadExcelClientSide","sorted","sort","b","localeCompare","grouped","forEach","res","pathArr","folderId","pid","buildFolderPath","topFolder","_objectSpread","__pathArr","data","styleMap","rowIndex","Object","keys","sectionIdx","sectionRow","row","headerRow","itemNumber","documentTitle","issuer","documentNumber","date","ws","XLSX","aoa_to_sheet","info","cellAddress","encode_cell","r","c","s","bold","sz","alignment","horizontal","vertical","italic","wrapText","col","headerCell","border","top","style","bottom","rowIdx","some","cellAddr","left","right","wch","e","wb","book_new","book_append_sheet"],"ignoreList":[],"sourceRoot":""}